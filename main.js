(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}var n,r;return n=e,(r=[{key:"getUserInfo",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),{method:"GET",headers:this._headers}).then(this._handleResponse)}},{key:"setUserInfo",value:function(t){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t.name,about:t.about})}).then(this._handleResponse)}},{key:"addNewCard",value:function(t){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t.name,link:t.link})}).then(this._handleResponse)}},{key:"deleteCard",value:function(t){return fetch("".concat(this._baseUrl,"/cards/").concat(t._id),{method:"DELETE",headers:this._headers}).then(this._handleResponse)}},{key:"getInitialCards",value:function(){return fetch("".concat(this._baseUrl,"/cards"),{method:"GET",headers:this._headers}).then(this._handleResponse)}},{key:"updateUserAvatar",value:function(t){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t.avatar})}).then(this._handleResponse)}},{key:"likeCard",value:function(t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(t._id),{method:"PUT",headers:this._headers}).then(this._handleResponse)}},{key:"dislikeCard",value:function(t){return fetch("".concat(this._baseUrl,"/cards/likes/").concat(t._id),{method:"DELETE",headers:this._headers}).then(this._handleResponse)}},{key:"_handleResponse",value:function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}}])&&t(n.prototype,r),e}();function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var r=function(){function t(e,n,r,o){var i=o.handleCardClick,a=o.handleTrashButtonClick,u=o.handleLike,s=o.handleDislike;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._selector=n,this._currentUserId=r,this._handleCardClick=i,this._handleTrashButtonClick=a,this._handleLike=u,this._handleDislike=s}var e,r;return e=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._selector)}},{key:"_generateCard",value:function(){return this._card=this._getTemplate().content.querySelector(".grid-item").cloneNode(!0),this._card.setAttribute("id",this._data._id),this._cardImg=this._card.querySelector(".grid-item__photo"),this._nameElement=this._card.querySelector(".grid-item__title"),this._likeButton=this._card.querySelector(".grid-item__like-btn"),this._likeCountElement=this._card.querySelector(".grid-item__like-count"),this._trashButton=this._card.querySelector(".grid-item__trash-btn"),this._cardImg.src=this._data.link,this._cardImg.alt=this._data.name,this._nameElement.textContent=this._data.name,this._setTrashButtonVisibility(),this._setLikedState(),this._setLikesCount(),this._card}},{key:"_setLikesCount",value:function(){this._likeCountElement.textContent=this._data.likes.length}},{key:"_setTrashButtonVisibility",value:function(){this._checkIsOwnCard()||this._trashButton.remove()}},{key:"_checkIsOwnCard",value:function(){return this._data.owner._id===this._currentUserId}},{key:"_checkHasOwnLike",value:function(){var t=this;return this._data.likes.some((function(e){return e._id===t._currentUserId}))}},{key:"_setLikedState",value:function(){this._checkHasOwnLike()?this._likeButton.classList.add("grid-item__like-btn_liked"):this._likeButton.classList.remove("grid-item__like-btn_liked")}},{key:"_setEventListeners",value:function(){var t=this;this._likeButton.addEventListener("click",(function(){return t._handleLikeButtonClick()})),this._trashButton.addEventListener("click",(function(){return t._handleTrashButtonClick(t._data)})),this._cardImg.addEventListener("click",(function(){return t._handleCardClick(t._data)}))}},{key:"_handleLikeButtonClick",value:function(){this._checkHasOwnLike()?this._handleDislike(this._data):this._handleLike(this._data)}},{key:"updateData",value:function(t){this._data=t,this._setLikedState(),this._setLikesCount()}},{key:"getCard",value:function(){return this._generateCard(),this._setEventListeners(),this._card}}])&&n(e.prototype,r),t}();function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._formElement=n,this._params=e,this._inputList=Array.from(this._formElement.querySelectorAll(this._params.inputSelector)),this._buttonElement=this._formElement.querySelector(this._params.submitButtonSelector)}var e,n;return e=t,(n=[{key:"_showInputError",value:function(t,e){var n=this._formElement.querySelector("#".concat(t.id,"-error"));t.classList.add(this._params.inputErrorClass),n.classList.add(this._params.errorClass),n.textContent=e}},{key:"_hideInputError",value:function(t){var e=this._formElement.querySelector("#".concat(t.id,"-error"));t.classList.remove(this._params.inputErrorClass),e.classList.remove(this._params.errorClass),e.textContent=""}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(t){return!t.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._params.inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.classList.remove(this._params.inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))}},{key:"_setEventListeners",value:function(){var t=this;this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._toggleButtonState(),t._checkInputValidity(e)}))}))}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}},{key:"checkInputList",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._inputList.forEach((function(n){e?t._hideInputError(n):t._checkInputValidity(n)})),this._toggleButtonState()}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(t){t.preventDefault()})),this._setEventListeners()}}])&&o(e.prototype,n),t}();function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=e,this._containerSelector=n}var e,n;return e=t,(n=[{key:"renderItems",value:function(t){var e=this;t.forEach((function(t){e._renderer(t)}))}},{key:"addItem",value:function(t){this._containerSelector.append(t)}}])&&a(e.prototype,n),t}();function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._element=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this),this.setEventListeners=this.setEventListeners.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this._element.classList.add("popup_opened"),document.addEventListener("keyup",this._handleEscClose)}},{key:"close",value:function(){this._element.classList.remove("popup_opened"),document.removeEventListener("keyup",this._handleEscClose)}},{key:"_handleEscClose",value:function(t){t.preventDefault(),"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this._element.addEventListener("click",(function(e){e.target.classList.contains("popup__close-btn")&&t.close()})),this._element.addEventListener("click",(function(e){e.target!==e.currentTarget&&e.target.parentNode!==e.currentTarget||t.close()}),!1)}}])&&s(e.prototype,n),t}();function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_(r);if(o){var n=_(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return d(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t))._popupImg=e._element.querySelector(".popup__place-img"),e._popupLabel=e._element.querySelector(".popup__place-label"),e}return e=a,(n=[{key:"open",value:function(t){p(_(a.prototype),"open",this).call(this),this._popupImg.src=t.link,this._popupImg.alt=t.name,this._popupLabel.textContent=t.name}}])&&f(e.prototype,n),a}(c);function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function b(t,e,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function E(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=g(r);if(o){var n=g(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return E(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._handleFormSubmit=e,n._formElement=n._element.querySelector("form"),n._submitButton=n._formElement.querySelector(".popup__button"),n._initialSubmitButtonStateText=n._submitButton.textContent,n}return e=a,(n=[{key:"_getInputValues",value:function(){var t={};return this._element.querySelectorAll(".popup__input").forEach((function(e){t[e.name]=e.value})),t}},{key:"setEventListeners",value:function(){var t=this;b(g(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._getInputValues())}))}},{key:"close",value:function(){this._formElement.reset(),b(g(a.prototype),"close",this).call(this)}},{key:"updateSubmitButtonText",value:function(t){this._submitButton.textContent=t?"Сохранение...":this._initialSubmitButtonStateText}}])&&v(e.prototype,n),a}(c);function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function L(t,e,n){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=T(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function I(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=T(r);if(o){var n=T(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return I(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._handleFormSubmit=e,n._formElement=n._element.querySelector("form"),n}return e=a,(n=[{key:"setEventListeners",value:function(){var t=this;L(T(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(e){e.preventDefault(),t._handleFormSubmit(t._data)}))}},{key:"open",value:function(t){this._data=t,L(T(a.prototype),"open",this).call(this)}}])&&w(e.prototype,n),a}(c);function j(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var R=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._profileTitleElement=document.querySelector(e),this._profileDescriptionElement=document.querySelector(n),this._profileAvatarElement=document.querySelector(r)}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{title:this._profileTitleElement.textContent,description:this._profileDescriptionElement.textContent,avatar:this._profileAvatarElement.src}}},{key:"setUserInfo",value:function(t){var e=t.name,n=t.about,r=t.avatar;this._profileTitleElement.textContent=e,this._profileDescriptionElement.textContent=n,this.setAvatar({name:e,avatar:r})}},{key:"setAvatar",value:function(t){var e=t.name,n=t.avatar;this._profileAvatarElement.src=n,this._profileAvatarElement.alt="Аватар ".concat(e),this._profileAvatarElement.title="Аватар ".concat(e)}}])&&j(e.prototype,n),t}(),P=".profile__avatar",q=document.querySelector(".grid"),U=(document.querySelector(P),document.querySelector(".popup__input-person")),x=document.querySelector(".popup__input-position"),D=document.querySelector(".popup__input-avatar"),A=document.querySelector(".popup__form-avatar"),V=document.querySelector(".popup__form-profile"),N=document.querySelector(".popup__form-place"),H=document.querySelector(".profile__edit-button"),F=document.querySelector(".profile__avatar-edit-button"),J=document.querySelector(".profile__add-button"),G={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},z=new u((function(t){var e=rt(t);z.addItem(e)}),q),M=new e({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-18",headers:{authorization:"df22a34d-0827-4604-b3c3-15999daac8f2","Content-Type":"application/json"}}),K=null,Q=new R(".profile__title",".profile__subtitle",P);M.getUserInfo().then((function(t){K=t._id,Q.setUserInfo(t)})).catch((function(t){return console.log(t)})),M.getInitialCards().then((function(t){z.renderItems(t)})).catch((function(t){return console.log(t)}));var W=new S(".popup_type_person-form",(function(t){this.updateSubmitButtonText(!0),M.setUserInfo({name:t.person,about:t.position}).then((function(t){Q.setUserInfo(t),W.close()})).catch((function(t){return console.log(t)})).finally((function(){W.updateSubmitButtonText(!1)}))})),X=new i(G,V);W.setEventListeners(),X.enableValidation();var Y=new S(".popup_type_avatar-form",(function(t){this.updateSubmitButtonText(!0),M.updateUserAvatar(t).then((function(t){Q.setUserInfo(t),Y.close()})).catch((function(t){return console.log(t)})).finally((function(){Y.updateSubmitButtonText(!1)}))})),Z=new i(G,A);Y.setEventListeners(),Z.enableValidation();var $=new S(".popup_type_place-form",(function(t){var e=this;this.updateSubmitButtonText(!0),M.addNewCard({name:t.placename,link:t.placepic}).then((function(t){var n=rt(t);e._element.querySelector(".popup__button").classList.add(G.inactiveButtonClass),q.prepend(n),$.close()})).catch((function(t){return console.log(t)})).finally((function(){$.updateSubmitButtonText(!1)}))})),tt=new i(G,N);$.setEventListeners(),tt.enableValidation();var et=new B(".popup_type_confirm-form",(function(t){M.deleteCard(t).then((function(e){document.getElementById(t._id).remove(),et.close()})).catch((function(t){return console.log(t)}))}));et.setEventListeners();var nt=new y(".popup_type_place");function rt(t){return new r(t,"#card-template",K,{handleCardClick:ot,handleTrashButtonClick:it,handleLike:at,handleDislike:ut}).getCard()}function ot(t){nt.open(t)}function it(t){et.open(t)}function at(t){var e=this;M.likeCard(t).then((function(t){e.updateData(t)})).catch((function(t){return console.log(t)}))}function ut(t){var e=this;M.dislikeCard(t).then((function(t){e.updateData(t)})).catch((function(t){return console.log(t)}))}nt.setEventListeners(),H.addEventListener("click",(function(){var t=Q.getUserInfo();U.value=t.title,x.value=t.description,X.checkInputList(),W.open()})),F.addEventListener("click",(function(){var t=Q.getUserInfo();D.value=t.avatar,X.checkInputList(),Y.open()})),J.addEventListener("click",(function(){$.open(),tt.checkInputList(!0)}))})();